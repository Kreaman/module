<?//Сайтif (isset($_GET[site])){$site=$_GET[site];}else{$site= "home";}//Базы данных MySQLmysql_connect($host, $usernamedb, $passworddb) or die(); mysql_select_db("$base") or die();//Категорииfunction categories(){$categories=mysql_query("SELECT * FROM categories");echo "<b>Меню сайта</b><li><a href=\"index.php\">Главная страница</a></li>";while ($category=mysql_fetch_array($categories))	{	echo "<li><a href=\"?site=category&cat=$category[name]\">$category[name]</a></li>";	}}//Удаление категории админомfunction categoriesdelete(){$categories=mysql_query("SELECT * FROM categories");while ($category=mysql_fetch_array($categories))	{	echo "<li><a href=\"admin.php?deletecat=$category[name]\">$category[name]</a></li>";	}	echo "<br><b>Создать категорию</b><br>	<form action=\"admin.php\" method=\"get\">	<label for=cat>Имя: </label><input name=\"categorynew\" type=\"text\" id=cat value=\"\" size=\"20\" maxlength=\"20\" class=txt>	<center><input name=\"addcategory\" type=\"submit\" value=\"Добавить\" class=btn></center>	</form>";}//Список категорий в админпанеле для добавления в них новостейfunction categoriesform(){$categories=mysql_query("SELECT * FROM categories");echo "<br>Категория: <select name=\"cat\">";while ($category=mysql_fetch_array($categories))	{	echo"<option value=\"$category[name]\">$category[name]</option>";	}echo"</select><br>";}function editnews($yz){echo "<b>Редактирование новостей</b>";	$selectinfo=mysql_query("SELECT * FROM news");	$select=mysql_query("SELECT * FROM news ORDER by id DESC LIMIT $yz, 10") or die(mysql_error());	while ($news=mysql_fetch_array($select))	{	echo "<li><a href='?edit=$news[id]'>$news[title]</a> <a href='?delete=$news[id]'>[ Удалить ]</a></li>";	}	strani($x, $selectinfo, 10);}//Форма редактирования новостейfunction editform($id){echo "<b>Редактирование новостей</b><br>Убедитесь, что вы выбрали правельную категорию.<br>";$select=mysql_query("SELECT * FROM news WHERE id='$id'");$news=mysql_fetch_array($select);	echo"	<form action=\"admin.php\" method=\"post\" name=\"enews\">	Заголовок <br>	<input name=\"etitle\" type=\"text\" value=\"$news[title]\" size=\"50\" maxlength=\"200\" class=txt><br>	Содержание <br>	<textarea name=\"etext\" cols=\"40\" rows=\"10\" class=txt>$news[text]</textarea><br>";		categoriesform();		echo "	Теги: <input name=\"etags\" type=\"text\" value=\"$news[tags]\" size=\"50\" maxlength=\"200\" class=txt><br>	<input name=\"main\" type=\"checkbox\" value=\"1\" id=onmain checked>	<LABEL for=onmain>Отображать на главной странице</LABEL><br>	<input name=\"edit\" type=\"hidden\" value=\"$_GET[edit]\">	<input name=\"submit\" type=\"submit\" value=\"Изменить\" class=btn>	</form>";}function editnewsquery($title, $text, $category, $main, $id, $tags){echo "<div class=done>Новость успешно отредактирована.</div>";$update=mysql_query("UPDATE news SET title='$title', text='$text', cat='$category', tags='$tags', main='$main' WHERE id='$id'") OR die(mysql_error());}//Форма добавления новостейfunction submitform(){echo "<br><br>	<b>Добавление новости</b>	<br>	<form action=\"admin.php\" method=\"post\" name=\"news\">	<input name=\"title\" type=\"text\" size=\"50\" maxlength=\"200\" class=txt><br>	Содержание:<br>	<textarea name=\"text\" cols=\"40\" rows=\"10\" class=txt></textarea><br>";	categoriesform();	echo "	Теги: <input name=\"tags\" type=\"text\" value=\"$news[tags]\" size=\"50\" maxlength=\"200\" class=txt><br>	<input name=\"main\" type=\"checkbox\" value=\"1\" id=onmain checked>	<LABEL for=onmain>Отображать на главной странице</LABEL><br>	<input name=\"submit\" type=\"submit\" value=\"Добавить\" class=btn>	</form>";}//Вид новостейfunction writenews($news){$date=date('d.m.Y', $news[time]);echo "<div class=title><b>$date</b><h1><a href='?site=news&id=$news[id]' title='$news[title]'>$news[title]</a></h1></div><br>	$news[text]	<br><hr>";}//Вид комментариевfunction writecomment($news){$date=date('d.m.Y', $news[time]);echo "<div class=comment>	<b>$news[name]</b> [ <i>$date</i> ]	<br>	$news[text]</div>";}//Расчёт количества страниц$x=0;if (isset($_GET[x])){$x=$_GET[x];$x=$x-1;}$yz=$x*5;//Страницаfunction strani($x, $query, $num){$koliko=mysql_num_rows($query);$strani=round($koliko/$num+0.5);$y=$x+2;$w=$x;$x=$x+1;	echo "<br><br>Страницы: ";	if($strani=='1')	{	echo "<a href='?x=1'>1</a>";	}	elseif ($strani=='2')	{		echo "<a href='?x=1'>1</a> ";		echo "<a href='?x=2'>2</a>";	}	elseif ($strani=='3')	{		echo "<a href='?x=1'>1</a> ";		echo "<a href='?x=2'>2</a> ";		echo "<a href='?x=3'>3</a>";	}	elseif($y>=$strani)	{	$y=$strani;	$w=$strani-2;	$x=$strani-1;	echo "	<a href='?x=1'>1</a> ... 	<a href='?x=$w'>$w</a> 	<a href='?x=$x'>$x</a>	<a href='?x=$y'>$y</a>";	} 	elseif ($w<=1)	{		echo "<a href='?x=1'>1</a>	<a href='?x=2'>2</a> 	<a href='?x=3'>3</a> ... 	<a href='?x=$strani'>$strani</a>";	}	else	{	echo "<a href='?x=1'>1</a> ... 	<a href='?x=$w'>$w</a> 	<a href='?x=$x'>$x</a>	<a href='?x=$y'>$y</a>  ... 	<a href='?x=$strani'>$strani</a>";	}}function categorystrani($x, $query, $num, $cat){$koliko=mysql_num_rows($query);$strani=round($koliko/$num+0.5);$y=$x+2;$w=$x;$x=$x+1;	echo "<br><br>Страницы: ";	if($strani=='1')	{	echo "<a href='?site=category&cat=$cat&x=1'>1</a>";	}	elseif ($strani=='2')	{		echo "<a href='?site=category&cat=$cat&x=1'>1</a> ";		echo "<a href='?site=category&cat=$cat&x=2'>2</a>";	}	elseif ($strani=='3')	{		echo "<a href='?site=category&cat=$cat&x=1'>1</a> ";		echo "<a href='?site=category&cat=$cat&x=2'>2</a> ";		echo "<a href='?site=category&cat=$cat&x=3'>3</a>";	}	elseif($y>=$strani)	{	$y=$strani;	$w=$strani-2;	$x=$strani-1;	echo "	<a href='?site=category&cat=$cat&x=1'>1</a> ... 	<a href='?site=category&cat=$cat&x=$w'>$w</a> 	<a href='?site=category&cat=$cat&x=$x'>$x</a>	<a href='?site=category&cat=$cat&x=$y'>$y</a>";	} 	elseif ($w<=1)	{		echo "<a href='?site=category&cat=$cat&x=1'>1</a>	<a href='?site=category&cat=$cat&x=2'>2</a> 	<a href='?site=category&cat=$cat&x=3'>3</a> ... 	<a href='?site=category&cat=$cat&x=$strani'>$strani</a>";	}	else	{	echo "<a href='?site=category&cat=$cat&x=1'>1</a> ... 	<a href='?site=category&cat=$cat&x=$w'>$w</a> 	<a href='?site=category&cat=$cat&x=$x'>$x</a>	<a href='?site=category&cat=$cat&x=$y'>$y</a>  ... 	<a href='?site=category&cat=$cat&x=$strani'>$strani</a>";	}}//Страницаfunction stranikomentarjev($x, $query, $num, $id){$koliko=mysql_num_rows($query);$strani=round($koliko/$num+0.5);$site=$_GET[site];$y=$x+2;$w=$x;$x=$x+1;	echo "<br><br>Страницы: ";	if($strani=='1')	{	echo "<a href='?site=news&id=$id&x=1'>1</a>";	}	elseif ($strani=='2')	{		echo "<a href='?site=news&id=$id&x=1'>1</a> ";		echo "<a href='?site=news&id=$id&x=2'>2</a>";	}	elseif ($strani=='3')	{		echo "<a href='?site=news&id=$id&x=1'>1</a> ";		echo "<a href='?site=news&id=$id&x=2'>2</a> ";		echo "<a href='?site=news&id=$id&x=3'>3</a>";	}	elseif($y>=$strani)	{	$y=$strani;	$w=$strani-2;	$x=$strani-1;	echo "	<a href='?site=news&id=$id&x=1'>1</a> ... 	<a href='?site=news&id=$id&x=$w'>$w</a> 	<a href='?site=news&id=$id&x=$x'>$x</a>	<a href='?site=news&id=$id&x=$y'>$y</a>";	} 	elseif ($w<=1)	{		echo "<a href='?site=news&id=$id&x=1'>1</a>	<a href='?site=news&id=$id&x=2'>2</a> 	<a href='?site=news&id=$id&x=3'>3</a> ... 	<a href='?site=news&id=$id&x=$strani'>$strani</a>";	}	else	{	echo "<a href='?site=news&id=$id&x=1'>1</a> ... 	<a href='?site=news&id=$id&x=$w'>$w</a> 	<a href='?site=news&id=$id&x=$x'>$x</a>	<a href='?site=news&id=$id&x=$y'>$y</a>  ... 	<a href='?site=news&id=$id&x=$strani'>$strani</a>";	}}// Форма добавления комментариевfunction comment(){echo "<hr><center><div class=comform><center><b>Оставить комментарий</b></center><form name=\"comment\" method=\"post\" action=\"?site=news&id=$_GET[id]\"><label for=myname>Ваше имя </label> <input type=\"text\" name=\"name\" id=myname value=\"Аноним\" class=txt><br><textarea name=\"text\"cols=\"60\" rows=\"5\" class=txt></textarea><br><input name=\"commentsubmit\" type=\"submit\" value=\"Добавить\" class=btn></form></div></center><hr>";}// Получаем рейтинг из БДfunction rate($id){if(is_numeric($_GET[id])){$f1=mysql_query("SELECT * FROM rating WHERE newsid='$_GET[id]'");}else{exit("Mysql");}while($f=mysql_fetch_array($f1)){$g=$g+$f[rate];}// Рейтинг новостиif (mysql_num_rows($f1)!=0){$f=$g/mysql_num_rows($f1);$f=round($f, 1);}	echo "Оценка: ";	for ($d=1; $d<6; $d++)	{	echo "<a href=\"?site=news&id=$id&rate=$d\" class=star><b>$d</b></a>";	}	echo "&nbsp; &nbsp; Рейтинг <b>$f из 5</b>";if (isset($_GET[rate])){if ($_GET[rate]<11){$ip=$_SERVER["REMOTE_ADDR"];if(!is_numeric($_GET[id])){exit("MySql");}// Отчёты об успешной оценке новости, вывод ошибки.if (mysql_num_rows(mysql_query("SELECT * FROM rating WHERE ip='$ip' AND newsid='$_GET[id]'"))==0)   {   $mysql=mysql_query("INSERT INTO rating(id, rate, ip, newsid, time) VALUES ('','$_GET[rate]','$ip','$_GET[id]','$time')");   echo "<div class=done>Вы оценили новость как $_GET[rate]</div>";   }else	{	echo "<div class=error>Вы уже оценивали эту новость!</div>";	}  } }}?>